/**
 * @name jQuery waterfall Plugin
 * @version 1.0.4
 * @create 2012.1.30
 * @lastmodified 2012.2.4
 * @description Based on jQuery 1.4+
 * @author MuFeng (http://mufeng.me)
 * @url http://mufeng.me/waterfall.html
 **/
~function(b){var e=[],d=0,c=function(f,g){this.options=f;this.element=b(g);this.init()};c.prototype={init:function(){this.initArg();this.reSize();this.layout(this.bricks)},getBricks:function(g){var f=this.options.itemSelector;return $bricks=!f?g.children().not(".waterfall"):g.filter(f).not(".waterfall").add(g.find(f))},getSize:function(){this.bricks=this.getBricks(this.element);var l=this.bricks[0],j=b(l),m=this.options.columnCount,f=this.options.columnWidth,k=[],i=j.outerWidth(true),g=b(window).width()-20,o=!f?i:f,h=!m?parseInt(g/o):m;return k.concat(o,h)},initArg:function(){if(!d){var f,h=this.getSize(),g=h[1];for(f=0;f<g;f++){e[f]=0}d=1}},reSize:function(){this.element.css("position","relative");if(this.options.isResizable){var h=this.getSize(),g=h[1],f=h[0];this.element.css({width:g*f,margin:"0 auto"})}},layout:function(r){var m=0,s=this.element,f=r.length,q=s.filter("img").add(s.find("img")).eq(0),x=q.parent(),h=this.options.isAnimated,p=this.options.Duration,g=this.options.Easing,A=this.options.endFn,o=this.getSize(),u=o[0],z,v=x.width()-parseInt(q.css("padding-left"))-parseInt(q.css("padding-right"))-parseInt(q.css("margin-left"))-parseInt(q.css("margin-right"));r.css("display","none");var j=(function(){var t=[],n=null,i=function(){var B=0;for(;B<t.length;B++){t[B].end?t.splice(B--,1):t[B]()}!t.length&&w()},w=function(){clearInterval(n);n=null};return function(L,H,I,M){var O,N,J,G,K,B=new Image();B.src=L;if(B.complete){H(B.width,B.height);I&&I(B.width,B.height);return}N=B.width;J=B.height;O=function(){G=B.width;K=B.height;if(G!==N||K!==J||G*K>1024){H(G,K);O.end=true}};O();B.onerror=function(){M&&M();G=0;K=0;H(G,K);O.end=true;B=B.onload=B.onerror=null};B.onload=function(){I&&I(B.width,B.height);!O.end&&O();B=B.onload=B.onerror=null};if(!O.end){t.push(O);if(n===null){n=setInterval(i,40)}}}})();l();function l(){if(m<f){var B=r[m],i=b(B),w=i.filter("img").add(i.find("img")),C=i.outerHeight(true),t=k(e);if(w.length>0){var n=w.attr("src");w.removeAttr("src");j(n,function(G,F){G=G?G:v;F=F?F:0;y=F*v/G;G=v;w.attr({src:n,width:G,height:F});var I=Math.max.apply(Math,e);s.height(I);i.addClass("waterfall");var H=i.outerHeight(true);!h?(i.css({display:"block",position:"absolute",left:t*u,top:e[t]})):(i.css({display:"block",position:"absolute",left:0,top:I}).animate({left:t*u,top:e[t]},{duration:p,easing:g}));e[t]+=H;m++;z=setTimeout(l,10)})}else{var E=Math.max.apply(Math,e);s.height(E);i.addClass("waterfall");var D=i.outerHeight(true);!h?(i.css({display:"block",position:"absolute",left:t*u,top:e[t]})):(i.css({display:"block",position:"absolute",left:0,top:E}).animate({left:t*u,top:e[t]},{duration:p,easing:g}));e[t]+=D;m++;z=setTimeout(l,10)}}else{if(m>=f){clearTimeout(z);z=null;var E=Math.max.apply(Math,e);s.height(E);if(typeof A=="function"){A.call(r)}}}}function k(n){var t,w=0,i=n[0],B=n.length;for(t=1;t<B;t++){if(n[t]<i){i=n[t];w=t}}return w}}};b.waterfall=function(f,g){f=b.extend({isResizable:false,isAnimated:false,isAppend:false,Duration:500,Easing:"swing",endFn:function(){}},f);b.data("waterfall",new c(f,g));return g};b.fn.waterfall=function(f){return b.waterfall(f,this)};function a(f){console.log({}.toString.call(f)+" | "+f)}}(jQuery);