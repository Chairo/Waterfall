/**
 * @name jQuery waterfall Plugin
 * @version 1.0.5
 * @create 2012.1.30
 * @lastmodified 2012.2.5
 * @description Based on jQuery 1.4+
 * @author MuFeng (http://mufeng.me)
 * @url http://mufeng.me/waterfall.html
 **/
~function(f){var h=[],i=0,j=function(b,a){this.opt=b;this.ele=f(a);this.init()};j.prototype={init:function(){this.iA();this.rS();this.lot(this.gB(this.ele))},gB:function(a){var b=this.opt.itemSelector;return $bricks=!b?a.children().not(".waterfall"):a.filter(b).not(".waterfall").add(a.find(b))},getSize:function(){var c=this.gB(this.ele)[0],e=f(c),b=this.opt.columnCount,r=this.opt.columnWidth,d=[],n=e.outerWidth(true),q=f(window).width()-20,a=!r?n:r,p=!b?parseInt(q/a):b;return d.concat(a,p)},iA:function(){if(!i){var c,a=this.getSize(),b=a[1];for(c=0;c<b;c++){h[c]=0}i=1}},rS:function(){this.ele.css("position","relative");if(this.opt.isResizable){var a=this.getSize(),b=a[1],c=a[0];this.ele.css({width:b*c,margin:"0 auto"})}},lot:function(a){var n=0,J=this.ele,E=a.length,b=J.filter("img").add(J.find("img")).eq(0),G=b.parent(),C=this.opt.isAnimated,c=this.opt.Duration,D=this.opt.Easing,e=this.opt.endFn,d=this.getSize(),I=d[0],F,H=G.width()-parseInt(b.css("padding-left"))-parseInt(b.css("padding-right"))-parseInt(b.css("margin-left"))-parseInt(b.css("margin-right"));a.css("display","none");var B=(function(){var m=[],o=null,l=function(){var p=0;for(;p<m.length;p++){m[p].end?m.splice(p--,1):m[p]()}!m.length&&k()},k=function(){clearTimeout(o);o=null};return function(u,A,z,s){var q,r,x,P,v,p=new Image();p.src=u;if(p.complete){A(p.width,p.height);z&&z(p.width,p.height);return}r=p.width;x=p.height;q=function(){P=p.width;v=p.height;if(P!==r||v!==x||P*v>1024){A(P,v);q.end=true}};q();p.onerror=function(){s&&s();P=0;v=0;A(P,v);q.end=true;p=p.onload=p.onerror=null};p.onload=function(){z&&z(p.width,p.height);!q.end&&q();p=p.onload=p.onerror=null};if(!q.end){m.push(q);if(o===null){o=setTimeout(l,50)}}}})();t();function t(){if(n<E){var s=a[n],m=f(s),k=m.filter("img").add(m.find("img")),q=m.outerHeight(true),l=w(h);if(k.length>0){var r=k.attr("src");k.removeAttr("src");B(r,function(x,z){x=x?x:H;z=z?z:0;y=z*H/x;x=H;k.attr({src:r,width:x,height:z});var u=Math.max.apply(Math,h);J.height(u);m.addClass("waterfall");var v=m.outerHeight(true);!C?(m.css({display:"block",position:"absolute",left:l*I,top:h[l]})):(m.css({display:"block",position:"absolute",left:0,top:u}).stop().animate({left:l*I,top:h[l]},{duration:c,easing:D}));h[l]+=v;n++;F=setTimeout(t,50)})}else{var o=Math.max.apply(Math,h);J.height(o);m.addClass("waterfall");var p=m.outerHeight(true);!C?(m.css({display:"block",position:"absolute",left:l*I,top:h[l]})):(m.css({display:"block",position:"absolute",left:0,top:o}).stop().animate({left:l*I,top:h[l]},{duration:c,easing:D}));h[l]+=p;n++;F=setTimeout(t,10)}}else{if(n>=E){clearTimeout(F);F=null;var o=Math.max.apply(Math,h);J.height(o);if(typeof e=="function"){e.call(a)}}}}function w(p){var m,k=0,l=p[0],o=p.length;for(m=1;m<o;m++){if(p[m]<l){l=p[m];k=m}}return k}}};f.waterfall=function(b,a){b=f.extend({isResizable:false,isAnimated:false,isAppend:false,Duration:500,Easing:"swing",endFn:function(){}},b);f.data(a,"waterfall",new j(b,a));return a};f.fn.waterfall=function(a){return f.waterfall(a,this)};function g(a){console.log({}.toString.call(a)+" | "+a)}}(jQuery);